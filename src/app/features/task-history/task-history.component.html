<div class="page-container">

    <app-table-toolbar [tabs]="tabs" [activeTab]="activeTab" [onlyMeActive]="onlyMeActive"
        [searchText]="quickFilterText" [activeFilterCount]="activeFilterCount" (tabChange)="onTabChange($event)"
        (onlyMeChange)="onOnlyMeChange($event)" (searchChange)="onSearchChange($event)"
        (clearFilters)="onClearFilters()">
        <div toolbar-actions class="actions">
            <button mat-stroked-button (click)="deepUpdate()">
                <mat-icon>update</mat-icon> Deep Update
            </button>

            <button mat-stroked-button (click)="deepInsert()">
                <mat-icon>add</mat-icon> Deep Insert
            </button>

            <button mat-stroked-button (click)="downloadSnapshot()">
                <mat-icon>download</mat-icon> Snapshot
            </button>

            <button mat-stroked-button (click)="reload()">
                <mat-icon>refresh</mat-icon> Reload
            </button>
        </div>
    </app-table-toolbar>

    <div class="card-container">
        @if (taskHistoryService.historyResource.isLoading()) {
        <app-skeleton-loading-overlay></app-skeleton-loading-overlay>
        } @else if (taskHistoryService.historyResource.error()) {
        <div class="error-container">
            Error loading history.
            <button mat-button (click)="reload()">Retry</button>
        </div>
        } @else {
        <app-ag-grid-wrapper [rowData]="taskHistoryService.historyResource.value() || []" [columnDefs]="columnDefs"
            [quickFilterText]="quickFilterText" (gridReady)="onGridReady($event)">
        </app-ag-grid-wrapper>
        }
    </div>
</div>

<ng-template #domainsDialog let-data>
    <h2 mat-dialog-title>Blocked Domains</h2>
    <mat-dialog-content>
        @if (data.domains && data.domains.length > 0) {
        <ul class="domain-list">
            @for (domain of data.domains; track domain) {
            <li>{{ domain }}</li>
            }
        </ul>
        } @else {
        <p>No blocked domains.</p>
        }
    </mat-dialog-content>
    <mat-dialog-actions align="end">
        <button mat-button mat-dialog-close>Close</button>
    </mat-dialog-actions>
</ng-template>