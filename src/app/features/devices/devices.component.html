<div class="page-container">

    <app-table-toolbar [tabs]="tabs" [activeTab]="activeTab" [onlyMeActive]="onlyMeActive"
        [searchText]="quickFilterText" [activeFilterCount]="activeFilterCount" (tabChange)="onTabChange($event)"
        (onlyMeChange)="onOnlyMeChange($event)" (searchChange)="onSearchChange($event)"
        (clearFilters)="onClearFilters()">
        <div toolbar-actions class="actions">
            <button mat-flat-button color="primary" (click)="fileInput.click()">
                <mat-icon>upload_file</mat-icon> Import TXT
            </button>
            <input #fileInput type="file" (change)="onFileSelected($event)" style="display: none" accept=".txt" />

            <button mat-stroked-button (click)="deepUpdate()">
                <mat-icon>update</mat-icon> Deep Update
            </button>

            <button mat-stroked-button (click)="reload()">
                <mat-icon>refresh</mat-icon> Reload
            </button>
        </div>
    </app-table-toolbar>

    <div class="grid-container">
        @if (devicesService.devicesResource.isLoading()) {
        <!-- Using custom skeleton overlay component directly instead of a row wrapper since AG Grid is hidden by default without data if not styled properly, 
                 or we render the grid and trigger loading API. Instead, we insert the overlay directly during load. -->
        <app-skeleton-loading-overlay></app-skeleton-loading-overlay>
        } @else if (devicesService.devicesResource.error()) {
        <div class="error-container">
            Error loading devices.
            <button mat-button (click)="reload()">Retry</button>
        </div>
        } @else {
        <app-ag-grid-wrapper [rowData]="devicesService.devicesResource.value() || []" [columnDefs]="columnDefs"
            [quickFilterText]="quickFilterText" (gridReady)="onGridReady($event)">
        </app-ag-grid-wrapper>
        }
    </div>
</div>